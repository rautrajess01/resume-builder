{% load static %}

<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0d6efd" />

  {# Tailwind CSS via CDN for quick styling #}
  <script src="https://cdn.tailwindcss.com"></script>

  {# Dark mode initialization BEFORE page paints #}
  <script>
    (function () {
      const storedTheme = localStorage.getItem('theme');
      const systemPrefersDark = window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches;

      if (storedTheme === 'dark' || (!storedTheme && systemPrefersDark)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    })();
  </script>

  <title>
    {% block title %}Resume Builder{% endblock %}
  </title>
</head>

<body class="h-full bg-slate-100 text-slate-900 dark:bg-slate-900 dark:text-slate-100">
  <div class="min-h-screen flex flex-col">
    {# Header / Navbar #}
    <header class="border-b border-slate-200 bg-white/80 backdrop-blur dark:bg-slate-900/80 dark:border-slate-800">
      <nav class="mx-auto flex max-w-5xl items-center justify-between px-4 py-3 sm:px-6 lg:px-8">
        <div class="flex items-center gap-2">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-lg bg-indigo-600 text-white shadow-sm dark:bg-indigo-500">
            <span class="text-lg font-bold">RB</span>
          </span>
          <div class="flex flex-col">
            <a href="{% url 'resume_list' %}" class="text-base font-semibold tracking-tight hover:text-indigo-600 dark:hover:text-indigo-400">
              Resume Builder
            </a>
            <span class="text-xs text-slate-500 dark:text-slate-400">
              Create and manage your professional resume
            </span>
          </div>
        </div>

        <div class="flex items-center gap-3">
          {% if user.is_authenticated %}
            <a href="{% url 'dashboard' %}" class="hidden text-sm font-medium text-slate-600 hover:text-indigo-600 dark:text-slate-300 dark:hover:text-indigo-400 sm:inline">
              Dashboard
            </a>
            <a href="{% url 'resume_list' %}" class="hidden text-sm font-medium text-slate-600 hover:text-indigo-600 dark:text-slate-300 dark:hover:text-indigo-400 sm:inline">
              My Resumes
            </a>
            <a href="{% url 'logout' %}"
               class="rounded-full border border-slate-300 px-3 py-1.5 text-xs font-medium text-slate-700 shadow-sm hover:border-indigo-500 hover:text-indigo-600 dark:border-slate-700 dark:text-slate-200 dark:hover:border-indigo-400 dark:hover:text-indigo-300">
              Logout
            </a>
          {% else %}
            <a href="{% url 'login' %}"
               class="hidden text-sm font-medium text-slate-600 hover:text-indigo-600 dark:text-slate-300 dark:hover:text-indigo-400 sm:inline">
              Login
            </a>
            <a href="{% url 'register' %}"
               class="rounded-full bg-indigo-600 px-3 py-1.5 text-xs font-medium text-white shadow-sm hover:bg-indigo-700 dark:bg-indigo-500 dark:hover:bg-indigo-600">
              Sign up
            </a>
          {% endif %}

          {# Dark mode toggle #}
          <button id="theme-toggle"
                  type="button"
                  class="inline-flex h-8 w-8 items-center justify-center rounded-full border border-slate-300 text-slate-700 shadow-sm hover:border-indigo-500 hover:text-indigo-600 dark:border-slate-700 dark:text-slate-200 dark:hover:border-indigo-400 dark:hover:text-indigo-200"
                  aria-label="Toggle dark mode">
            <svg id="theme-toggle-light-icon" class="hidden h-4 w-4" viewBox="0 0 24 24" fill="none">
              <path d="M12 3v2.5M12 18.5V21M4.22 4.22 5.9 5.9M18.1 18.1l1.68 1.68M3 12h2.5M18.5 12H21M4.22 19.78 5.9 18.1M18.1 5.9l1.68-1.68M16 12a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z"
                    stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <svg id="theme-toggle-dark-icon" class="hidden h-4 w-4" viewBox="0 0 24 24" fill="none">
              <path d="M20 12.41A8 8 0 0 1 11.59 4 6 6 0 1 0 20 12.41Z"
                    stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </div>
      </nav>
    </header>

    {# Page content #}
    <main class="flex-1">
      <div class="mx-auto flex max-w-5xl flex-col px-4 py-6 sm:px-6 lg:px-8 lg:py-10">
        {% if messages %}
          <div class="mb-4 space-y-2">
            {% for message in messages %}
              <div class="rounded-md border px-3 py-2 text-sm
                          {% if message.tags == 'success' %}
                            border-emerald-300 bg-emerald-50 text-emerald-800 dark:border-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-100
                          {% elif message.tags == 'error' %}
                            border-rose-300 bg-rose-50 text-rose-800 dark:border-rose-700 dark:bg-rose-900/40 dark:text-rose-100
                          {% else %}
                            border-slate-300 bg-white text-slate-800 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100
                          {% endif %}">
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}

        <section class="w-full rounded-2xl border border-slate-200 bg-white/80 p-5 shadow-sm backdrop-blur dark:border-slate-800 dark:bg-slate-900/80 sm:p-7">
          {% block body %}{% endblock %}
        </section>
      </div>
    </main>

    {# Footer #}
    <footer class="border-t border-slate-200 bg-white/80 py-4 text-xs text-slate-500 backdrop-blur dark:border-slate-800 dark:bg-slate-900/80 dark:text-slate-400">
      <div class="mx-auto flex max-w-5xl items-center justify-between px-4 sm:px-6 lg:px-8">
        <p>&copy; {{ now|default:None }} Resume Builder. All rights reserved.</p>
        <p class="hidden sm:inline">
          Built as a college project with Django.
        </p>
      </div>
    </footer>
  </div>

  <script>
    (function () {
      const toggle = document.getElementById('theme-toggle');
      const lightIcon = document.getElementById('theme-toggle-light-icon');
      const darkIcon = document.getElementById('theme-toggle-dark-icon');

      function updateIcons() {
        const isDark = document.documentElement.classList.contains('dark');
        if (isDark) {
          darkIcon.classList.add('hidden');
          lightIcon.classList.remove('hidden');
        } else {
          lightIcon.classList.add('hidden');
          darkIcon.classList.remove('hidden');
        }
      }

      if (toggle && lightIcon && darkIcon) {
        updateIcons();

        toggle.addEventListener('click', function () {
          const isDark = document.documentElement.classList.toggle('dark');
          localStorage.setItem('theme', isDark ? 'dark' : 'light');
          updateIcons();
        });
      }
    })();
  </script>
</body>
</html>

